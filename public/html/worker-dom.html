<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="../css/css-version.css">
</head>

<body>
    <div src="../js/worker-dom.js" id="hello">
        <div id='placeholder'></div>
    </div>
    <!-- 要素の幅を取得するために利用するDOM -->
    <span id="ruler"></span>
    <!-- /socket.io/socket.io.js は自動で生成されるので作成する必要はない -->
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="../js/worker-dom.js"></script>
    <script>
        let socket = io();

        // ブラウザに何行のコメントを表示するか
        const windowDevided = 11;
        // コメント1行の高さを取得
        let commentHeight = Math.round(document.documentElement.clientHeight / windowDevided);
        let commentMoveWidth = document.documentElement.clientWidth;

        // 各行の情報を持つ配列の作成
        let row = Array(windowDevided);
        for (let i = 0; i < windowDevided; i++) {
            row[i] = {
                bornTime: 0,
                speed: 0,
                width: 0,
            }
        }

        // 接続時の処理
        socket.on('connect', () => {
            console.log("socket.ioに接続しました");
        });

        // サーバーからのメッセージ拡散に対する処理
        socket.on('spread message', (strMessage) => {
            // OPENRECのコメントがスタンプの場合は処理しない
            if (strMessage.length == 0) return;

            // 流れるコメントの作成
            calcRow(strMessage);
        });

        window.onresize = () => {
            commentHeight = Math.round(document.documentElement.clientHeight / windowDevided);
            commentMoveWidth = document.documentElement.clientWidth;
        }

    </script>
    <script type="module">
        import {upgradeElement} from 'https://unpkg.com/@ampproject/worker-dom@0.2.8/dist/unminified.index.mjs';
        upgradeElement(document.getElementById('hello'), 'https://unpkg.com/@ampproject/worker-dom@0.2.8/dist/unminified.worker.mjs');
    </script>
</body>

</html>